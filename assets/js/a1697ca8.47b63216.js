"use strict";(self.webpackChunkturbowarp_docs=self.webpackChunkturbowarp_docs||[]).push([[345],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),c=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=c(e.components);return r.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},h=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),h=c(n),m=a,d=h["".concat(l,".").concat(m)]||h[m]||u[m]||o;return n?r.createElement(d,i(i({ref:t},p),{},{components:n})):r.createElement(d,i({ref:t},p))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=h;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var c=2;c<o;c++)i[c]=n[c];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}h.displayName="MDXCreateElement"},8640:(e,t,n)=>{n.r(t),n.d(t,{frontMatter:()=>s,contentTitle:()=>l,metadata:()=>c,toc:()=>p,default:()=>h});var r=n(7462),a=n(3366),o=(n(7294),n(3905));const i=["components"],s={slug:"/how",hide_table_of_contents:!0},l="How TurboWarp runs projects faster",c={unversionedId:"website/how-it-works",id:"website/how-it-works",isDocsHomePage:!1,title:"How TurboWarp runs projects faster",description:"TurboWarp uses a compiler to while Scratch uses an interpreter. This allows TurboWarp to run up to 20x faster, but it makes live script editing impracticable\\[1\\].",source:"@site/docs/website/how-it-works.md",sourceDirName:"website",slug:"/how",permalink:"/how",editUrl:"https://github.com/TurboWarp/docs/edit/master/docs/website/how-it-works.md",version:"current",frontMatter:{slug:"/how",hide_table_of_contents:!0},sidebar:"sidebar",previous:{title:"Embedding",permalink:"/embedding"},next:{title:"How to see the JavaScript",permalink:"/javascript"}},p=[{value:"An analogy",id:"analogy",children:[]},{value:"Technical details",id:"technical-details",children:[]}],u={toc:p};function h(e){let{components:t}=e,s=(0,a.Z)(e,i);return(0,o.kt)("wrapper",(0,r.Z)({},u,s,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"how-turbowarp-runs-projects-faster"},"How TurboWarp runs projects faster"),(0,o.kt)("p",null,"TurboWarp uses a ",(0,o.kt)("em",{parentName:"p"},"compiler")," to while Scratch uses an ",(0,o.kt)("em",{parentName:"p"},"interpreter"),". This allows TurboWarp to run up to 20x faster, but it makes live script editing impracticable",(0,o.kt)("sup",null,(0,o.kt)("a",{parentName:"p",href:"#footnote-1"},"[","1","]")),"."),(0,o.kt)("h2",{id:"analogy"},"An analogy"),(0,o.kt)("p",null,"Consider a complicated math problem, something like long division, a crazy integral, that type of thing."),(0,o.kt)("p",null,"Scratch's interpreter is like evaluating it entirely by hand, using pencil and paper, without a calculator, using only physical books as reference."),(0,o.kt)("p",null,"TurboWarp's compiler is like making a computer solve it for you."),(0,o.kt)("p",null,"In the end, you should end up with the same result, but one of the methods will be a lot faster."),(0,o.kt)("h2",{id:"technical-details"},"Technical details"),(0,o.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"The section is simplified to make things easier to understand. The removed things are not that interesting."))),(0,o.kt)("p",null,"Consider the following script:"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"When green flag clicked, forever, move my variable steps",src:n(6373).Z})),(0,o.kt)("p",null,"Scratch's interpreter interprets an ",(0,o.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Abstract_syntax_tree"},"abstract syntax tree")," at runtime. Internally that looks something like this:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "va[U{Cbi_NZpSOSx_kVA": {\n    "opcode": "event_whenflagclicked",\n    "inputs": {},\n    "fields": {},\n    "next": "tzXnZ{8G!xK|t^WAWF{m",\n    "topLevel": true\n  },\n  "tzXnZ{8G!xK|t^WAWF{m": {\n    "opcode": "control_forever",\n    "inputs": {\n      "SUBSTACK": {\n        "name": "SUBSTACK",\n        "block": "$xf$bq|xl(}RhT-K,taS"\n      }\n    },\n    "fields": {},\n    "next": null,\n    "topLevel": false\n  },\n  "$xf$bq|xl(}RhT-K,taS": {\n    "opcode": "motion_movesteps",\n    "inputs": {\n      "STEPS": {\n        "name": "STEPS",\n        "block": "cw__.I:g}Y~`:5KmO00q"\n      }\n    },\n    "fields": {},\n    "next": null,\n    "topLevel": false\n  },\n  "cw__.I:g}Y~`:5KmO00q": {\n    "opcode": "data_variable",\n    "inputs": {},\n    "fields": {\n      "VARIABLE": {\n        "name": "VARIABLE",\n        "id": "`jEk@4|i[#Fk?(8x)AV.-my variable"\n      }\n    },\n    "next": null,\n    "topLevel": false\n  }\n}\n')),(0,o.kt)("p",null,"Whenever Scratch executes any block, it has to do a lot of things:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"It has to look up the block's opcode, to see what code it has to run"),(0,o.kt)("li",{parentName:"ul"},"It has to figure out whether the block has any inputs or fields (similar but different), and evaluate those if it has any. Inputs themselves are blocks that also have to be executed the same as any other, and so are their inputs, and so on."),(0,o.kt)("li",{parentName:"ul"},"It has to see whether or not there is another block to execute after the current one"),(0,o.kt)("li",{parentName:"ul"},"It has to maintain an internal stack and other state to know what block it's executing at what time"),(0,o.kt)("li",{parentName:"ul"},"It has to constantly check to make sure that no scripts have changed"),(0,o.kt)("li",{parentName:"ul"},"etc. There is a ",(0,o.kt)("em",{parentName:"li"},"lot")," going on in Scratch whenever it executes even a single block")),(0,o.kt)("p",null,"The code that does all this is written in JavaScript. Your browser is already doing a similar variety of tasks whenever it executes any JavaScript code (it's much more complicated, don't worry too much about it), but now the overhead of the interpreter has to be added on top of that."),(0,o.kt)("p",null,"TurboWarp's compiler removes all of that overhead by converting scripts directly to JavaScript functions, for example, something like this:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'const b0 = stage.variables["`jEk@4|i[#Fk?(8x)AV.-my variable"];\nreturn function* () {\n  while (true) {\n    runtime.ext_scratch3_motion._moveSteps((+b0.value || 0), target);\n    if (thread.warp === 0 || isStuck()) yield;\n  }\n};\n')),(0,o.kt)("p",null,"Things to notice:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"No more looking up opcodes by hand: all the logic is just in the JavaScript"),(0,o.kt)("li",{parentName:"ul"},"No more looking up inputs or fields by hand: they're just JavaScript arguments"),(0,o.kt)("li",{parentName:"ul"},"No more manual state maintaining: your browser is very good at executing simple JavaScript functions and loops on its own"),(0,o.kt)("li",{parentName:"ul"},"As this is a JavaScript function, there is no way to modify its behavior after it's been created",(0,o.kt)("sup",null,(0,o.kt)("a",{parentName:"li",href:"#footnote-1"},"[","1","]")))),(0,o.kt)("p",null,"Of course, this is a very simple example where the interpreter overhead will be virtually meaningless. For the vast majority of projects, the interpreter is more than good enough. It's only when you start executing hundreds of thousands of blocks per frame that the interpreter overhead begins to become problematic."),(0,o.kt)("hr",null),(0,o.kt)("a",{name:"footnote-1"}),"[1] - It's not strictly impossible to edit JavaScript functions in some ways, but it's very difficult to do without hurting performance or adding significant complexity.")}h.isMDXComponent=!0},6373:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/forever-move-my-variable-steps-10bcdaf50d9e546e1e72b636ba037326.png"}}]);